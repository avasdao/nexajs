{"version":3,"file":"node_modules_theia_mini-browser_lib_browser_environment_mini-browser-environment-module_js.js","mappings":"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","sources":["webpack:///./node_modules/@theia/core/shared/@theia/application-package/lib/environment/index.js?","webpack:///./node_modules/@theia/mini-browser/src/browser/environment/mini-browser-environment-module.ts?","webpack:///./node_modules/@theia/mini-browser/src/browser/environment/mini-browser-environment.ts?","webpack:///./node_modules/@theia/mini-browser/src/common/mini-browser-endpoint.ts?"],"sourcesContent":["module.exports = require('@theia/application-package/lib/environment');\n","// *****************************************************************************\n// Copyright (C) 2020 Ericsson and others.\n//\n// This program and the accompanying materials are made available under the\n// terms of the Eclipse Public License v. 2.0 which is available at\n// http://www.eclipse.org/legal/epl-2.0.\n//\n// This Source Code may also be made available under the following Secondary\n// Licenses when the conditions for such availability set forth in the Eclipse\n// Public License v. 2.0 are satisfied: GNU General Public License, version 2\n// with the GNU Classpath Exception which is available at\n// https://www.gnu.org/software/classpath/license.html.\n//\n// SPDX-License-Identifier: EPL-2.0 OR GPL-2.0-only WITH Classpath-exception-2.0\n// *****************************************************************************\n\nimport { FrontendApplicationContribution } from '@theia/core/lib/browser';\nimport { ContainerModule } from '@theia/core/shared/inversify';\nimport { MiniBrowserEnvironment } from './mini-browser-environment';\n\nexport default new ContainerModule(bind => {\n    bind(MiniBrowserEnvironment).toSelf().inSingletonScope();\n    bind(FrontendApplicationContribution).toService(MiniBrowserEnvironment);\n});\n","// *****************************************************************************\n// Copyright (C) 2020 Ericsson and others.\n//\n// This program and the accompanying materials are made available under the\n// terms of the Eclipse Public License v. 2.0 which is available at\n// http://www.eclipse.org/legal/epl-2.0.\n//\n// This Source Code may also be made available under the following Secondary\n// Licenses when the conditions for such availability set forth in the Eclipse\n// Public License v. 2.0 are satisfied: GNU General Public License, version 2\n// with the GNU Classpath Exception which is available at\n// https://www.gnu.org/software/classpath/license.html.\n//\n// SPDX-License-Identifier: EPL-2.0 OR GPL-2.0-only WITH Classpath-exception-2.0\n// *****************************************************************************\n\nimport { Endpoint, FrontendApplicationContribution } from '@theia/core/lib/browser';\nimport { EnvVariablesServer } from '@theia/core/lib/common/env-variables';\nimport { environment } from '@theia/core/shared/@theia/application-package/lib/environment';\nimport { inject, injectable, postConstruct } from '@theia/core/shared/inversify';\nimport { v4 } from 'uuid';\nimport { MiniBrowserEndpoint } from '../../common/mini-browser-endpoint';\n\n/**\n * Fetch values from the backend's environment and caches them locally.\n * Helps with deploying various mini-browser endpoints.\n */\n@injectable()\nexport class MiniBrowserEnvironment implements FrontendApplicationContribution {\n\n    protected _hostPatternPromise: Promise<string>;\n    protected _hostPattern?: string;\n\n    @inject(EnvVariablesServer)\n    protected environment: EnvVariablesServer;\n\n    @postConstruct()\n    protected init(): void {\n        this._hostPatternPromise = this.getHostPattern()\n            .then(pattern => this._hostPattern = pattern);\n    }\n\n    get hostPatternPromise(): Promise<string> {\n        return this._hostPatternPromise;\n    }\n\n    get hostPattern(): string | undefined {\n        return this._hostPattern;\n    }\n\n    async onStart(): Promise<void> {\n        await this._hostPatternPromise;\n    }\n\n    /**\n     * Throws if `hostPatternPromise` is not yet resolved.\n     */\n    getEndpoint(uuid: string, hostname?: string): Endpoint {\n        if (this._hostPattern === undefined) {\n            throw new Error('MiniBrowserEnvironment is not finished initializing');\n        }\n        return new Endpoint({\n            path: MiniBrowserEndpoint.PATH,\n            host: this._hostPattern\n                .replace('{{uuid}}', uuid)\n                .replace('{{hostname}}', hostname || this.getDefaultHostname()),\n        });\n    }\n\n    /**\n     * Throws if `hostPatternPromise` is not yet resolved.\n     */\n    getRandomEndpoint(): Endpoint {\n        return this.getEndpoint(v4());\n    }\n\n    protected async getHostPattern(): Promise<string> {\n        return environment.electron.is()\n            ? MiniBrowserEndpoint.HOST_PATTERN_DEFAULT\n            : this.environment.getValue(MiniBrowserEndpoint.HOST_PATTERN_ENV)\n                .then(envVar => envVar?.value || MiniBrowserEndpoint.HOST_PATTERN_DEFAULT);\n    }\n\n    protected getDefaultHostname(): string {\n        return self.location.host;\n    }\n}\n","// *****************************************************************************\n// Copyright (C) 2020 Ericsson and others.\n//\n// This program and the accompanying materials are made available under the\n// terms of the Eclipse Public License v. 2.0 which is available at\n// http://www.eclipse.org/legal/epl-2.0.\n//\n// This Source Code may also be made available under the following Secondary\n// Licenses when the conditions for such availability set forth in the Eclipse\n// Public License v. 2.0 are satisfied: GNU General Public License, version 2\n// with the GNU Classpath Exception which is available at\n// https://www.gnu.org/software/classpath/license.html.\n//\n// SPDX-License-Identifier: EPL-2.0 OR GPL-2.0-only WITH Classpath-exception-2.0\n// *****************************************************************************\n\n/**\n * The mini-browser can now serve content on its own host/origin.\n *\n * The virtual host can be configured with this `THEIA_MINI_BROWSER_HOST_PATTERN`\n * environment variable. `{{hostname}}` represents the current host, and `{{uuid}}`\n * will be replace by a random uuid value.\n */\nexport namespace MiniBrowserEndpoint {\n    export const PATH = '/mini-browser';\n    export const HOST_PATTERN_ENV = 'THEIA_MINI_BROWSER_HOST_PATTERN';\n    export const HOST_PATTERN_DEFAULT = '{{uuid}}.mini-browser.{{hostname}}';\n}\n"],"names":[],"sourceRoot":""}